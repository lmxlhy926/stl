# UDP编程

UDP协议是User Datagram protocol的简写，**它是无连接的，不可靠的网络协议**。使用UDP进行程序设计可以分为客户端和服务器端两部分。服务器端主要包含建立套接字、将套接字和地址结构进行绑定、读写数据、关闭套接字几个过程。客户端包括建立套接字、读写数据、关闭套接字几个过程。服务器端和客户端两个流程之间的主要差别在于对地址的绑定函数，客户端可以不进行绑定操作。与TCP程序设计相比较，UDP缺少了connect()、listen()、accetp()函数，这是由于UDP协议无连接的特性，因为UDP协议不需要流量控制、不保证数据的可靠性收发，所以不需要服务器和客户端之间建立连接的过程。

客户端程序的端口和本地的地址可以由系统使用时指定，在使用sendto()和recvfrom的时候，网络协议栈会临时指定本地的端口和地址。



## **bind**

**bind的作用是将一个套接字文件描述符与一个本地地址绑定在一起，即把发送数据的端口地址和IP地址进行了指定**。例如在发送数据的时候，如果不进行绑定，则会临时选择一个随机的端口。



## **recvfrom**

在使用recvfrom()函数的时候，没有绑定发送方的地址。所以在接收数据的时候要判断发送方的地址，只有合适的发送方才能进行相应的处理，**这是因为不同的发送方发送的数据都可以到达接收方的套接字文件描述符**，这是由于UDP协议没有按照连接进行区分造成的。



## **sendto**

在本例的发送过程中，由于客户端没有设置本地的IP地址和本地端口，而这些参数是网络协议栈发送数据时的必须条件，所以**在UDP层网络协议栈会选择合适的端口**。发送的数据经过IP层的时候，客户端会选出合适的本地IP地址进行填充，并且将客户端的目的IP地址填充到IP报文中。发送的数据到达数据链路层的时候，会根据硬件的情况进行发送。

**客户端**

**UDP层**

```
客户端选出临时端口号 | 指定服务器的绑定端口
```

**IP层**

```
客户端选出IP地址 | 指定服务器IP地址
```

**数据链路层**



# UDP协议程序设计中的几个问题

## 报文丢失

**局域网**

利用UDP协议进行数据收发的时候，在局域网内一般情况下数据的接收方均能接收到发送方的数据，除非连接双方的主机发生故障，否则不会发生接收不到数据的情况。

**Internet**

在internet上，发送的数据要经过多个路由器。路由器要对转发的数据进行存储、处理、合法性判定、转发等操作，容易出现错误，所以很可能在路由器转发的过程中出现数据丢失的现象。

**对策**

**主机C发送的报文经过路由器到达主机S后，主机S要发送一个接收到此数据报文的响应**。主机C对主机S的响应进行记录，直到之前发送的数据报文已经被主机S接收到。如果数据报文经过路由器的时候，被路由器丢弃，则主机C和主机S会对超时的数据进行重发。

## 报文乱序

## 流量控制

## 外出网络接口

## 报文截断



















